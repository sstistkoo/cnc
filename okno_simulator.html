<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <!-- Optimalizovan√Ω viewport pro mobiln√≠ za≈ô√≠zen√≠ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- Meta tag pro iOS - zamezit zvƒõt≈°ov√°n√≠ prvk≈Ø -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CNC Simul√°tor</title>
    <link rel="stylesheet" href="css/simulator.css">
    <!-- Zabr√°nit ukl√°d√°n√≠ do mezipamƒõti bƒõhem v√Ωvoje -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
</head>
<body>
    <div id="canvas-container">
        <canvas id="grid-canvas"></canvas>
        <div class="controls">
            <button id="zoom-in" title="P≈ôibl√≠≈æit" aria-label="P≈ôibl√≠≈æit">+</button>
            <button id="zoom-out" title="Odd√°lit" aria-label="Odd√°lit">‚àí</button>
            <button id="reset" title="Reset zobrazen√≠" aria-label="Resetovat zobrazen√≠">‚Ü∫</button>
        </div>
        <div class="coordinates" id="coord-display">
            <div class="coord">X: 0</div>
            <div class="coord">Z: 0</div>
        </div>
        <!-- Ponech√°me pouze statick√© popisky os -->
        <div class="axis-label x-axis">X</div>
        <div class="axis-arrow x-axis"></div>
        <div class="axis-label z-axis">Z</div>
        <div class="axis-arrow z-axis"></div>
        <div class="cross-marker" id="cross-marker"></div>
    </div>

    <div class="playback-controls" id="playback-controls">
        <button id="step-backward" title="Krok vzad" aria-label="Krok vzad" class="playback-button">‚èÆ</button>
        <button id="play-pause" title="P≈ôehr√°t/Pozastavit" aria-label="P≈ôehr√°t nebo pozastavit" class="playback-button">‚ñ∂</button>
        <button id="step-forward" title="Krok vp≈ôed" aria-label="Krok vp≈ôed" class="playback-button">‚è≠</button>
        <button id="stop" title="Stop" aria-label="Stop" class="playback-button">‚èπ</button>
        <div class="speed-controls">
            <button id="speed-down" title="Sn√≠≈æit rychlost" aria-label="Sn√≠≈æit rychlost">‚àí</button>
            <span class="playback-speed" id="speed-display">1√ó</span>
            <button id="speed-up" title="Zv√Ω≈°it rychlost" aria-label="Zv√Ω≈°it rychlost">+</button>
            <button id="speed-reset" title="Resetovat rychlost" aria-label="Resetovat rychlost">‚Ü∫</button>
        </div>
        <!-- Tlaƒç√≠tko pro minimalizaci se p≈ôid√° dynamicky v JS mezi speed-reset a controls-toggle -->
        <button id="controls-toggle" title="Zobrazit/skr√Ωt ovl√°d√°n√≠" aria-label="Zobrazit nebo skr√Ωt ovl√°d√°n√≠">üëÅÔ∏è</button>
        <button id="panel-toggle" title="Otev≈ô√≠t/zav≈ô√≠t panel" aria-label="Otev≈ô√≠t nebo zav≈ô√≠t panel">‚ò∞</button>
    </div>

    <div class="sliding-panel" id="sliding-panel">
        <div class="panel-handle" id="panel-handle"></div>
        <div class="panel-content">
            <h2>Informaƒçn√≠ Panel</h2>
            <!-- Upraven√Ω informaƒçn√≠ panel s lep≈°√≠ strukturou -->
            <div style="display: flex; justify-content: space-between; margin-top: 15px; flex-wrap: wrap;">
                <div style="flex-basis: 48%; min-width: 200px; margin-bottom: 10px;">
                    <h3 style="font-size: 16px; margin-bottom: 8px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Informace o programu</h3>
                    <div id="program-info" style="font-size: 14px; line-height: 1.4;">
                        ≈Ω√°dn√Ω program nenaƒçten
                    </div>
                </div>
                <div style="flex-basis: 48%; min-width: 200px; margin-bottom: 10px;">
                    <h3 style="font-size: 16px; margin-bottom: 8px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Stav simulace</h3>
                    <div id="simulation-status" style="font-size: 14px;">
                        <p>P≈ôipraveno</p>
                        <p style="margin-top: 5px;">Pou≈æijte ovl√°dac√≠ prvky pro simulaci programu.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zjednodu≈°en√≠ naƒç√≠t√°n√≠ modul≈Ø s lep≈°√≠m zpracov√°n√≠m chyb pro mobiln√≠ za≈ô√≠zen√≠ -->
    <script type="module">
        // Poƒçkat na naƒç√≠t√°n√≠ DOM
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM loaded');

            // Detekce mobiln√≠ho za≈ô√≠zen√≠
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                console.log('Detekov√°no mobiln√≠ za≈ô√≠zen√≠:', navigator.userAgent);
                document.body.classList.add('mobile-device');
            }

            try {
                const { initializeGrid } = await import('./js/grid-renderer.js');
                console.log('Grid module loaded');

                const { setupPlaybackControls } = await import('./js/playback-controls.js');
                console.log('Playback controls module loaded');

                const { setupPanel, togglePanel } = await import('./js/panel-manager.js');
                console.log('Panel module loaded');

                // Inicializace
                console.log('Initializing components...');
                initializeGrid();
                setupPlaybackControls();
                setupPanel();
                console.log('Initialization complete');

                // P≈ôidat p≈ô√≠m√Ω event listener na tlaƒç√≠tko panel-toggle
                const panelToggleBtn = document.getElementById('panel-toggle');
                if (panelToggleBtn) {
                    console.log('Panel toggle button found, adding direct click listener');
                    panelToggleBtn.addEventListener('click', function(e) {
                        console.log('Panel toggle clicked directly');
                        e.preventDefault();
                        togglePanel(); // Pou≈æ√≠t exportovanou funkci
                    });
                } else {
                    console.error('Panel toggle button not found');
                }

                // Zabr√°nit nechtƒõn√©mu zoomov√°n√≠ na iOS za≈ô√≠zen√≠ch p≈ôi dvojit√©m klepnut√≠
                document.addEventListener('gesturestart', function(e) {
                    e.preventDefault();
                });
            } catch (error) {
                console.error('Error during initialization:', error);
                // Zobrazit u≈æivatelsky p≈ô√≠vƒõtivou chybu
                const errorMessage = document.createElement('div');
                errorMessage.style.position = 'fixed';
                errorMessage.style.top = '50%';
                errorMessage.style.left = '50%';
                errorMessage.style.transform = 'translate(-50%, -50%)';
                errorMessage.style.padding = '20px';
                errorMessage.style.backgroundColor = 'rgba(255, 0, 0, 0.8)';
                errorMessage.style.color = 'white';
                errorMessage.style.borderRadius = '10px';
                errorMessage.style.maxWidth = '80%';
                errorMessage.style.textAlign = 'center';
                errorMessage.textContent = 'Chyba p≈ôi naƒç√≠t√°n√≠ simul√°toru. Zkuste obnovit str√°nku.';
                document.body.appendChild(errorMessage);
            }
        });
    </script>
</body>
</html>
